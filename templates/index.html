<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ò†‚ò†</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        /* üé® CSS: Giao Di·ªán Dark Mode (Hacker Style) */
        :root {
            --bg-color: #000000;
            --text-color: #00ff00;
            --accent-color: #008000;
            --font-family: 'Consolas', 'Courier New', monospace;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-family);
            margin: 0;
            padding: 0; 
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            overflow-x: hidden;
        }

        /* üé¨ Video N·ªÅn Hacker Full Screen (Gi·ªØ nguy√™n) */
        #background-video {
            position: fixed;
            top: 50%;
            left: 50%;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            z-index: -100;
            transform: translate(-50%, -50%);
            filter: brightness(0.4) grayscale(0.2); 
        }

        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6); 
            z-index: -99;
        }

        .container {
            width: 95%; 
            max-width: 1200px;
            padding: 20px 10px; 
            z-index: 1; 
        }

        h1 {
            color: var(--accent-color);
            text-align: center;
            text-shadow: 0 0 5px var(--accent-color);
            margin-bottom: 30px;
            font-size: 2em;
            white-space: nowrap; 
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); 
            gap: 15px;
            padding: 15px;
            border: 1px solid var(--accent-color);
            box-shadow: 0 0 15px var(--accent-color);
            margin-bottom: 30px;
        }

        .media-item { /* ƒê·ªïi t·ª´ .image-item th√†nh .media-item */
            overflow: hidden;
            border: 1px solid var(--text-color);
            position: relative;
            height: 120px; /* Chi·ªÅu cao c·ªë ƒë·ªãnh */
            background-color: #1a1a1a; /* M√†u n·ªÅn khi t·∫£i ho·∫∑c video/·∫£nh l·ªói */
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--text-color);
            font-size: 0.8em;
            text-align: center;
        }

        .media-item img,
        .media-item video {
            width: 100%;
            height: 100%; /* Chi·∫øm to√†n b·ªô chi·ªÅu cao c·ªßa media-item */
            object-fit: cover; /* ƒê·∫£m b·∫£o n·ªôi dung v·ª´a khung m√† kh√¥ng b·ªã m√©o */
            display: block;
        }

        /* Icon cho video */
        .media-item.video::before {
            content: "‚ñ∂Ô∏è"; /* Icon play */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2em;
            color: white;
            z-index: 10;
            text-shadow: 0 0 5px black;
        }

        .controls {
            display: flex;
            justify-content: space-around; 
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap; 
        }

        .controls button {
            background-color: var(--accent-color);
            color: var(--bg-color);
            border: 2px solid var(--text-color);
            padding: 8px 15px; 
            font-family: var(--font-family);
            font-size: 1em;
            cursor: pointer;
        }

        #download-zip-btn {
            background-color: #ff0000;
            border-color: #ffcc00;
            color: white;
            padding: 10px 20px;
            order: -1; 
            flex-basis: 100%; 
        }
        
        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-grow: 1;
            justify-content: space-between;
        }

        /* üì± MEDIA QUERY: T·ªëi ∆∞u cho m√†n h√¨nh l·ªõn h∆°n */
        @media (min-width: 600px) {
            #gallery {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
            }
            .media-item {
                height: 150px;
            }
            .controls {
                flex-wrap: nowrap;
                justify-content: center;
                gap: 50px;
            }
            #download-zip-btn {
                order: 0; 
                flex-basis: auto;
            }
        }
    </style>
</head>
<body>
    <video autoplay muted loop id="background-video">
        <source src="https://cdn.mtdv.me/video/trolled.mp4" type="video/mp4"> 
        Your browser does not support the video tag.
    </video>
    <div class="overlay"></div>

    <div class="container">
        <h1>[ ‚ò† GALLERY ‚ò† ]</h1>
        
        <div id="gallery">
            </div>

        <div class="controls">
            <button id="download-zip-btn">‚¨áÔ∏è DOWNLOAD ‚¨áÔ∏è</button>
            
            <div class="pagination-controls">
                <button id="prev-btn">‚èÆÔ∏èB4CK</button>
                <span id="page-info">Page 1/1</span>
                <button id="next-btn">N3XT ‚è≠Ô∏è</button>
            </div>
            
            <div id="status-message"></div>
        </div>
    </div>

    <script>
        const allUrls = {{ urls | tojson }};

        const imagesPerPage = 30; 
        let currentPage = 1;
        let totalPages = 0;
        
        const gallery = document.getElementById('gallery');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const pageInfo = document.getElementById('page-info');
        const downloadZipBtn = document.getElementById('download-zip-btn');
        const statusMessage = document.getElementById('status-message');

        // =========================================================
        //                 PH·∫¶N X·ª¨ L√ù N√âN ZIP
        // =========================================================
        // Logic n√†y c·∫ßn ƒë∆∞·ª£c c·∫£i thi·ªán ƒë·ªÉ ch·ªâ n√©n ·∫£nh, kh√¥ng n√©n video.
        // Ho·∫∑c n√©n video n·∫øu b·∫°n mu·ªën, nh∆∞ng k√≠ch th∆∞·ªõc s·∫Ω r·∫•t l·ªõn.
        // T√¥i s·∫Ω s·ª≠a ƒë·ªïi ƒë·ªÉ ch·ªâ n√©n ·∫£nh.

        async function fetchMediaAsBlob(url) {
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return await response.arrayBuffer(); 
            } catch (error) {
                console.error(`L·ªói t·∫£i media t·ª´ ${url}:`, error);
                return null;
            }
        }
        
        downloadZipBtn.addEventListener('click', async () => {
            if (allUrls.length === 0) {
                statusMessage.textContent = "[ TH√îNG B√ÅO: KH√îNG C√ì URL N√ÄO ƒê·ªÇ T·∫¢I XU·ªêNG. ]";
                return;
            }

            downloadZipBtn.disabled = true;
            statusMessage.textContent = "[ B·∫ÆT ƒê·∫¶U: ƒêang t·∫£i v√† n√©n 0 / " + allUrls.length + " media... ]";
            
            const zip = new JSZip();
            let loadedCount = 0;
            let failedCount = 0;
            const totalUrls = allUrls.length;

            const fetchPromises = allUrls.map(async (url, index) => {
                const urlLower = url.toLowerCase();
                // Ch·ªâ n√©n ·∫£nh, b·ªè qua video ƒë·ªÉ tr√°nh file ZIP qu√° l·ªõn
                if (urlLower.endsWith('.jpg') || urlLower.endsWith('.jpeg') || 
                    urlLower.endsWith('.png') || urlLower.endsWith('.gif')) {
                    
                    const data = await fetchMediaAsBlob(url);
                    
                    if (data) {
                        const filename = `media_${String(index + 1).padStart(3, '0')}.${urlLower.split('.').pop()}`;
                        zip.file(filename, data, { binary: true });
                        loadedCount++;
                        statusMessage.textContent = `[ TR·∫†NG TH√ÅI: ƒêang t·∫£i v√† n√©n ${loadedCount} / ${totalUrls} media (ch·ªâ ·∫£nh)... ]`;
                    } else {
                        failedCount++;
                    }
                } else {
                    // B·ªè qua video khi n√©n
                    failedCount++; // TƒÉng failed count cho c√°c item kh√¥ng ƒë∆∞·ª£c n√©n
                }
            });

            await Promise.all(fetchPromises);

            statusMessage.textContent = `[ TR·∫†NG TH√ÅI: ƒê√£ n√©n ${loadedCount} ·∫£nh. B·ªè qua ${totalUrls - loadedCount - failedCount} video. L·ªói ${failedCount} item. ƒêang t·∫°o file ZIP... ]`;

            if (loadedCount > 0) {
                const content = await zip.generateAsync({ type: "blob" });

                const now = new Date();
                const filename = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')}_${now.getHours().toString().padStart(2, '0')}-${now.getMinutes().toString().padStart(2, '0')}-${now.getSeconds().toString().padStart(2, '0')}.zip`;
                
                saveAs(content, filename);
                
                statusMessage.textContent = `[ TH√ÄNH C√îNG: ƒê√£ t·∫°o v√† t·∫£i xu·ªëng ${filename} ]`;
            } else {
                statusMessage.textContent = "[ L·ªñI NGHI√äM TR·ªåNG: KH√îNG TH·ªÇ T·∫¢I XU·ªêNG B·∫§T K·ª≤ ·∫¢NH N√ÄO. KI·ªÇM TRA L·∫†I URL. ]";
            }

            downloadZipBtn.disabled = false;
        });

        // =========================================================
        //                 PH·∫¶N X·ª¨ L√ù PH√ÇN TRANG (M·ªöI)
        // =========================================================

        function displayImages() {
            if (allUrls.length === 0) {
                gallery.innerHTML = '<p style="color: red; text-align: center;">[ ERROR: KH√îNG C√ì URL N√ÄO ƒê∆Ø·ª¢C T·∫¢I T·ª™ SERVER. ]</p>';
                totalPages = 0;
                updateControls();
                return;
            }

            const startIndex = (currentPage - 1) * imagesPerPage;
            const endIndex = Math.min(startIndex + imagesPerPage, allUrls.length); 
            const urlsToDisplay = allUrls.slice(startIndex, endIndex);

            gallery.innerHTML = ''; // X√≥a n·ªôi dung c≈©

            urlsToDisplay.forEach(url => {
                const div = document.createElement('div');
                div.className = 'media-item'; // ƒê·ªïi class t·ª´ image-item th√†nh media-item

                const urlLower = url.toLowerCase();

                if (urlLower.endsWith('.mp4') || urlLower.endsWith('.webm') || urlLower.endsWith('.ogg')) {
                    // N·∫øu l√† video
                    const video = document.createElement('video');
                    video.src = url;
                    video.autoplay = false; // Video trong l∆∞·ªõi kh√¥ng t·ª± ƒë·ªông ph√°t
                    video.loop = true;
                    video.muted = true; // Lu√¥n t·∫Øt ti·∫øng
                    video.controls = false; // Kh√¥ng hi·ªán controls m·∫∑c ƒë·ªãnh
                    video.setAttribute('playsinline', ''); // Quan tr·ªçng cho iOS
                    
                    div.classList.add('video'); // Th√™m class 'video' ƒë·ªÉ hi·ªán icon play
                    div.appendChild(video);

                    // Khi click v√†o video trong l∆∞·ªõi, c√≥ th·ªÉ b·∫≠t/t·∫Øt ti·∫øng ho·∫∑c m·ªü l·ªõn
                    div.addEventListener('click', () => {
                        if (video.paused) {
                            video.play();
                            div.classList.remove('video'); // ·∫®n icon play khi ƒëang ph√°t
                        } else {
                            video.pause();
                            div.classList.add('video'); // Hi·ªán l·∫°i icon play khi t·∫°m d·ª´ng
                        }
                    });

                } else if (urlLower.endsWith('.jpg') || urlLower.endsWith('.jpeg') || 
                           urlLower.endsWith('.png') || urlLower.endsWith('.gif') || 
                           urlLower.endsWith('.webp')) {
                    // N·∫øu l√† ·∫£nh
                    const img = document.createElement('img');
                    img.src = url;
                    img.alt = 'Media t·ª´ URL';
                    div.classList.add('image');
                    div.appendChild(img);
                } else {
                    // C√°c lo·∫°i URL kh√¥ng x√°c ƒë·ªãnh
                    div.textContent = '[ D·ªØ li·ªáu kh√¥ng h·ªó tr·ª£ ho·∫∑c l·ªói URL ]';
                    div.style.backgroundColor = '#440000'; // M√†u ƒë·ªè cho l·ªói
                }
                gallery.appendChild(div);
            });

            updateControls();
        }

        function updateControls() {
            totalPages = Math.ceil(allUrls.length / imagesPerPage);
            
            prevBtn.disabled = currentPage === 1 || totalPages <= 1;
            nextBtn.disabled = currentPage === totalPages || totalPages <= 1;
            pageInfo.textContent = `Trang ${currentPage}/${totalPages}`;
        }

        // --- X·ª¨ L√ù S·ª∞ KI·ªÜN N√öT PH√ÇN TRANG ---
        prevBtn.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                displayImages();
            }
        });

        nextBtn.addEventListener('click', () => {
            if (currentPage < totalPages) {
                currentPage++;
                displayImages();
            }
        });

        // --- KH·ªûI T·∫†O TRANG ---
        document.addEventListener('DOMContentLoaded', () => {
            displayImages(); 
        });
    </script>
</body>
</html>
